# Feature 0002: Search API & Basic Frontend

## Description
Implement a comprehensive search functionality for sewer inspections with filtering capabilities and a clean user interface. The system will allow users to search through inspection data by city, state, score range, and repair status, with results displayed in a card/table format limited to 100 records.

## Files to Create

### lib/search.ts
- **Purpose**: Core search logic and filtering functions
- **Key Function**: `searchInspections(filters: SearchFilters): Promise<SewerInspection[]>`
- **Algorithm**:
  1. Stream inspection data from S3 using existing streamFromS3 function
  2. Apply filters sequentially: city, state, score range, needsRepair
  3. Limit results to 100 records maximum
  4. Return filtered array of SewerInspection objects
- **Filter Logic**:
  - City: case-insensitive partial match on location.city
  - State: case-insensitive exact match on location.state  
  - Score Range: minScore <= inspection_score <= maxScore
  - Needs Repair: boolean match on requires_repair field

### app/api/search/route.ts
- **Purpose**: Search API endpoint with query parameter parsing
- **HTTP Method**: GET
- **Query Parameters**:
  - city: string (optional)
  - state: string (optional) 
  - minScore: number (default: 0)
  - maxScore: number (default: 100)
  - needsRepair: boolean string (optional)
- **Response Format**: `{ results: SewerInspection[], count: number }`
- **Integration**: Uses searchInspections function from lib/search.ts

### app/search/page.tsx
- **Purpose**: Main search interface page
- **Layout**: Full-page search interface with form and results
- **Components**: Integrates SearchForm and SearchResults components
- **State Management**: Local state for search results and loading states
- **Navigation**: Accessible via /search route

### components/SearchForm.tsx
- **Purpose**: Search form component with filter inputs
- **Fields**:
  - City input (text)
  - State dropdown/input (text)
  - Score range slider/inputs (min/max numbers)
  - Needs repair checkbox (boolean)
- **Features**:
  - Form validation
  - Loading state during search
  - Clear/reset functionality
  - Responsive design with Tailwind CSS

### components/SearchResults.tsx
- **Purpose**: Results display component in card/table format
- **Display Modes**: Card layout for mobile, table for desktop
- **Data Fields**: 
  - Inspection ID, timestamp, location (city/state)
  - Pipe material, diameter, age
  - Inspection score, defect count
  - Repair status badge
- **Features**:
  - Responsive design
  - Empty state handling
  - Result count display
  - Pagination controls (if needed)

## Files to Modify

### lib/types.ts
- **Current State**: Contains SewerInspection interface and SearchFilters
- **Verification**: Confirm SearchFilters interface supports required filter fields
- **Potential Addition**: SearchResponse interface if needed for API responses

### app/layout.tsx
- **Purpose**: Add navigation link to search page
- **Modification**: Include link/navigation to /search route

## Technical Requirements

### Search Algorithm
1. **Data Source**: Use existing S3 streaming from multiple part files
2. **Filtering Strategy**: Client-side filtering after streaming
3. **Performance**: Limit to 100 results to maintain responsiveness
4. **Memory Management**: Stream data incrementally, filter as processing

### UI/UX Design
- **Styling Framework**: Tailwind CSS (existing setup)
- **Typography**: Geist Sans and Geist Mono fonts (existing)
- **Theme**: Support for light/dark mode (existing CSS variables)
- **Responsiveness**: Mobile-first design with responsive breakpoints

### API Design
- **REST Pattern**: GET /api/search with query parameters
- **Error Handling**: Proper HTTP status codes and error messages
- **Response Format**: JSON with results array and metadata
- **Query Validation**: Validate and sanitize query parameters

### Component Architecture
- **Separation of Concerns**: Form logic separate from results display
- **State Management**: React useState for local component state
- **Event Handling**: Form submission, input changes, loading states
- **Accessibility**: Proper ARIA labels, keyboard navigation

## Data Flow
1. User submits search form with filters
2. SearchForm component calls API endpoint with query parameters
3. API endpoint parses parameters and calls searchInspections function
4. Search function streams S3 data and applies filters
5. Filtered results returned to frontend
6. SearchResults component displays formatted data
